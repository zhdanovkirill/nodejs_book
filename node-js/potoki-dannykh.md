---
description: Потоки для читання/запису та перетворення даних
---

# Lesson 2 - Потоки данных

## Потоки для читання/запису та перетворення даних

Вся концепція роботи потоків полягає у передачі даних між програмами в операціях введення/виводу. Використання потоків дозволяє програмі бути незалежною і поєднуватися з іншими програмами для створення більш складної системи.

Обмін даними здійснюється частинами, не чекаючи повного завантаження, що дозволяє ефективно використовувати оперативну пам'ять.

<figure><img src="https://lh5.googleusercontent.com/4SPtjDmcBEn4likxNloX1GKHFop8KwPcbCEMI9Cj_Eu6Vinbsk2hH-49jV32GZh0EUCL_wp7ZYyjH6U3HItrFFO4OhbJ03p20P5Qb7ncK-8y1M_WxDxzJ389JwEpzF8usNlVHQ7AQwfEd2oT4fPqgrW6kgEuYduQz86ckJF6cmnXE_KWnHt_VQ4aEQ" alt=""><figcaption></figcaption></figure>

Наприклад, потрібно знайти певний рядок у файлі великого обсягу. Використання потоку дозволяє отримувати дані частинами і шукати необхідний рядок у цих частинах, при збігу подальше читання файлу можна припинити, заощадивши при цьому час і продуктивні ресурси.

{% hint style="info" %}
За роботу з потоками Node.js відповідає вбудований модуль [**Stream**](https://nodejs.org/api/stream.html#stream), причому всі екземпляри об'єктів потоків є одночасно і екземплярами класу **EventEmitter,** що дозволяє ініціювати і обробляти події.
{% endhint %}

У Node.js є такі потоки:

* **Readable** - потік читання, що отримує дані з переданого джерела (наприклад, читання з файлу)**;**
* **Writable** - потік запису даних (наприклад, збереження даних у файл);
* **Duplex** - потік, що одночасно реалізує і читання, і запис;
* **Transform** - дуплексні потоки, які можуть змінювати або перетворювати дані в міру їх запису та читання.

### Потік Readable

Потік Readable відповідає за читання даних із певного джерела. Приклади потоків читання:

* отримання сервером HTTP запиту;
* отримання клієнтом відповіді на надісланий HTTP запит;
* читання із файлу;
* отримання даних із сокетів тощо;
* потік Readable працює в одному з двох режимів: flowing (процес отримання даних) і paused (режим очікування).

За замовчуванням всі потоки читання починають працювати з режим очікування. Щоб почати читання з джерела, необхідно додати обробник події data, або викликати метод `[ReadableStreamInstance].resume()`, або відправити потік на запис викликом методу pipe()

{% code lineNumbers="true" %}
```javascript
import {readFile} from 'node:fs';

let stream = readFile.createReadStream('./files/data.txt')
setTimeout(
   () =>
       stream.on('data', (data) =>
           console.log(data.toString())
       ),
   3000
)
```
{% endcode %}

Переведення в режим очікування, якщо для даних, що зчитуються, немає призначення, здійснюється викликом методу `[ReadableStreamInstance].pause()`.

{% hint style="info" %}
У разі явного виклику методу **resume()** без наявності обробника події data всі дані потоку будуть втрачені
{% endhint %}

Події Node.js потоку Readable:

* **data** – отримання потоком даних;
* **resume** - ініціюється під час виклику методу resume();
* **pause** - ініціюється під час виклику методу pause();
* **close** - виникає при закритті джерела даних чи самого потоку;
* **end** - генерується, коли з джерела зчитано всі дані;
* **error** - виникнення у потоці помилки, обробнику аргументом передається об'єкт помилки.

### **Потік Writable**

Потік Writable відповідає за запис даних у вказане місце. Приклади потоків запису:

* надсилання HTTP запиту з клієнта на сервер;
* надсилання відповіді на HTTP запит із сервера на клієнт;
* запис даних у файл;
* надсилання даних по сокету.
